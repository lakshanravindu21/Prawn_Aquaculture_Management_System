// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Represents a Prawn Pond
model Pond {
  id        Int      @id @default(autoincrement())
  name      String   // e.g., "Pond A"
  location  String?
  createdAt DateTime @default(now())

  // Relations
  readings    SensorReading[]
  alerts      Alert[]
  actuators   Actuator[]
  cameraLogs  CameraLog[]      // Link to camera footage
}

// 2. Stores the IoT Sensor Data
model SensorReading {
  id              Int      @id @default(autoincrement())
  timestamp       DateTime @default(now())

  // Water Quality Parameters
  ph              Float
  dissolvedOxygen Float    // DO
  temperature     Float
  turbidity       Float
  ammonia         Float
  salinity        Float?

  // Relation to Pond
  pondId Int
  pond   Pond @relation(fields: [pondId], references: [id], onDelete: Cascade)
}

// 3. Stores System Alerts
model Alert {
  id         Int      @id @default(autoincrement())
  timestamp  DateTime @default(now())
  level      String   // "INFO", "WARNING", "CRITICAL"
  message    String
  isResolved Boolean  @default(false)

  // Relation to Pond
  pondId Int
  pond   Pond @relation(fields: [pondId], references: [id], onDelete: Cascade)
}

// 4. Stores Actuator Status
model Actuator {
  id        Int      @id @default(autoincrement())
  name      String   // e.g., "Main Aerator"
  isOn      Boolean  @default(false)
  updatedAt DateTime @updatedAt

  // Relation to Pond
  pondId Int
  pond   Pond @relation(fields: [pondId], references: [id], onDelete: Cascade)
}

// 5. Stores User Accounts
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String   @default("Researcher")
  avatar    String?
  createdAt DateTime @default(now())
}

// 6. NEW: Stores Camera Photos & Videos
model CameraLog {
  id          Int      @id @default(autoincrement())
  timestamp   DateTime @default(now())
   
  type        String   // "IMAGE" or "VIDEO"
  url         String   // Link to Supabase Storage
  description String?  // AI analysis result

  // Relation to Pond
  pondId      Int
  pond        Pond     @relation(fields: [pondId], references: [id], onDelete: Cascade)
}